<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css">
  <link rel="stylesheet" href="dist/assets/styles/tailwind.css">
  <link rel="stylesheet" href="dist/assets/styles/main.css">
  <style>
    .navigation:hover .active-dot {
      opacity: 0.1;
    }

    .group:hover .dot:not(.active-dot) {
      background-color: rgba(0, 0, 0, 0.2);
    }
  </style>
  <title>Usual Tropes Studio</title>
</head>

<body>

  <section>
    <h1>Usual Tropes - Kanban Board</h1>
    <div class="board">
      <div class="column" data-status="todo">
        <h2>To Do</h2>
        <div class="task-container" id="todo"></div>
      </div>
      <div class="column" data-status="inProgress">
        <h2>In Progress</h2>
        <div class="task-container" id="inProgress"></div>
      </div>
      <div class="column" data-status="done">
        <h2>Done</h2>
        <div class="task-container" id="done"></div>
      </div>
    </div>
    <div class="new-task">
      <input type="text" id="newTaskInput" placeholder="New task..." />
      <button onclick="addTask()">Add Task</button>
    </div>
  </section>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCVTnuzGjb4qcNLWp_0kddmSL25o3Sqkzs",
  authDomain: "usual-tropes-board.firebaseapp.com",
  projectId: "usual-tropes-board",
  storageBucket: "usual-tropes-board.firebasestorage.app",
  messagingSenderId: "384616382226",
  appId: "1:384616382226:web:b85bd7261d36706faabdcb"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let boardData = {
      todo: [],
      inProgress: [],
      done: []
    };

    const boardRef = doc(db, "boards", "default");

    signInAnonymously(auth).then(async () => {
      const snap = await getDoc(boardRef);
      if (snap.exists()) {
        boardData = snap.data();
      }
      renderBoard();
    }).catch(console.error);

    function renderBoard() {
      for (let status of ["todo", "inProgress", "done"]) {
        const container = document.getElementById(status);
        container.innerHTML = "";
        boardData[status].forEach((task, index) => {
          const div = document.createElement("div");
          div.className = "task";
          div.draggable = true;
          div.textContent = task;
          div.dataset.index = index;
          div.dataset.status = status;
          container.appendChild(div);
        });
      }
    }

    window.addTask = async function () {
      const input = document.getElementById("newTaskInput");
      const task = input.value.trim();
      if (task) {
        boardData.todo.push(task);
        input.value = "";
        await saveBoard();
        renderBoard();
      }
    };

    async function saveBoard() {
      await setDoc(boardRef, boardData);
    }

    document.addEventListener("dragstart", (e) => {
      if (e.target.classList.contains("task")) {
        e.dataTransfer.setData("text/plain", JSON.stringify({
          status: e.target.dataset.status,
          index: e.target.dataset.index
        }));
      }
    });

    document.querySelectorAll(".task-container").forEach(container => {
      container.addEventListener("dragover", (e) => e.preventDefault());
      container.addEventListener("drop", async (e) => {
        e.preventDefault();
        const { status, index } = JSON.parse(e.dataTransfer.getData("text/plain"));
        const task = boardData[status].splice(index, 1)[0];
        const targetStatus = container.id;
        boardData[targetStatus].push(task);
        await saveBoard();
        renderBoard();
      });
    });

  </script>


</body>

</html>